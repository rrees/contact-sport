{% extends 'default.html' %}

{% block title %}{{directory.name}} | Directory{% endblock %}

{% block content %}
<h1>{{directory.name}}</h1>


{% if contacts %}
<ul>
	<li>{{contact.name}}</li>
</ul>
{% else %}
<p>This directory does not have any contacts assigned to it yet</p>
{% endif %}


<contact-searcher>
<details open>
	<summary>Add someone to the directory</summary>

	<form class="search-form" class="cluster">
		<label>Contact name: <input name="name" required maxlength="100"></label>
		<button type="submit">Find</button>
	</form>


	<div id="contact-search-results">
	</div>

</details>
</contact-searcher>

{% endblock %}

{% block script %}

<script defer>
	class ContactSearcher extends HTMLElement {
		constructor() {
			super();
			console.log('Hello world');
		}

		connectedCallback() {
			console.log('Component connected');

			const searchResultsElement = this.querySelector('#contact-search-results');

			function handleSearch(event) {
				event.preventDefault();
				event.target.disabled = true;
				const apiUrl = '{{url_for('directory_find_contacts_by_name', directory_id=directory.external_id, name="nick")}}';
				console.log(apiUrl);
				fetch(apiUrl).then((response) => {

					console.log(response);

					response.text().then((responseHtml) => {
						searchResultsElement.innerHTML = responseHtml;
					});
				}).finally(() => event.target.disabled = false);
			}

			this.querySelector('.search-form').addEventListener('click', handleSearch);
		}
	}

	customElements.define('contact-searcher', ContactSearcher);
</script>

{% endblock %}